<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>사각형 넓이 구하기</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    .problem-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    .problem {
      width: 45%;
      margin: 10px;
      text-align: center;
    }
    .rectangle-container {
      position: relative;
      display: inline-block;
      margin: 10px 0;
    }
    .rectangle {
      background-color: #a2d5f2;
      border: 2px solid #333;
    }
    .label {
      position: absolute;
      font-weight: bold;
      background-color: white;
      padding: 2px 5px;
      border: 1px solid #999;
      font-size: 14px;
    }
    .widthLabel {
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
    }
    .heightLabel {
      left: -55px;
      top: 50%;
      transform: translateY(-50%);
    }
    .result {
      margin-top: 5px;
      font-weight: bold;
    }
    #controls {
      margin-top: 30px;
    }
  </style>
</head>
<body>

  <h2>[문제] 다음 사각형의 넓이를 구하시오.</h2>

  <div>
    난이도 선택:
    <select id="difficulty">
      <option value="easy">초급 (5~10cm)</option>
      <option value="medium">중급 (10~20cm)</option>
      <option value="hard">고급 (15~30cm)</option>
    </select>
    <button onclick="generateProblems()">문제 시작</button>
  </div>

  <div id="problems" class="problem-container"></div>

  <div id="controls">
    <button onclick="gradeAnswers()">채점하기</button>
    <button onclick="retryIncorrect()">오답 다시 풀기</button>
  </div>

  <div id="endMessage" style="margin-top: 20px; font-weight: bold;"></div>

  <script>
    const numProblems = 10;
    const pixelPerCm = 10;
    let problems = [];
    let incorrectIndexes = [];

    function getRangeByDifficulty() {
      const diff = document.getElementById("difficulty").value;
      if (diff === "easy") return [5, 10];
      if (diff === "medium") return [10, 20];
      return [15, 30]; // hard
    }

    function generateProblems(onlyIncorrect = false) {
      const [minCm, maxCm] = getRangeByDifficulty();
      const container = document.getElementById("problems");
      document.getElementById("endMessage").innerText = "";

      if (!onlyIncorrect) {
        problems = [];
        container.innerHTML = '';
        for (let i = 0; i < numProblems; i++) {
          const width = getRandomInt(minCm, maxCm);
          const height = getRandomInt(minCm, maxCm);
          problems.push({ width, height, index: i });
        }
      } else {
        incorrectIndexes.forEach(i => {
          const width = getRandomInt(minCm, maxCm);
          const height = getRandomInt(minCm, maxCm);
          problems[i] = { width, height, index: i };
        });
      }

      renderProblems();
    }

    function renderProblems() {
      const container = document.getElementById("problems");
      container.innerHTML = '';

      problems.forEach((p, i) => {
        const problemDiv = document.createElement("div");
        problemDiv.className = "problem";
        problemDiv.innerHTML = `
          <div>문제 ${i + 1}</div>
          <div class="rectangle-container">
            <div class="label widthLabel">${p.width}cm</div>
            <div class="label heightLabel">${p.height}cm</div>
            <div class="rectangle" style="width: ${p.width * pixelPerCm}px; height: ${p.height * pixelPerCm}px;"></div>
          </div>
          <div>
            <label>넓이: </label>
            <input type="number" id="answer${i}">
            <span class="result" id="result${i}"></span>
          </div>
        `;
        container.appendChild(problemDiv);
      });
    }

    function gradeAnswers() {
      let score = 0;
      incorrectIndexes = [];

      for (let i = 0; i < problems.length; i++) {
        const userInput = parseInt(document.getElementById(`answer${i}`).value);
        const correct = problems[i].width * problems[i].height;
        const resultSpan = document.getElementById(`result${i}`);

        if (userInput === correct) {
          resultSpan.innerText = "✅ 정답";
          resultSpan.style.color = "green";
          score++;
        } else {
          resultSpan.innerText = `❌ 오답 (정답: ${correct})`;
          resultSpan.style.color = "red";
          incorrectIndexes.push(i);
        }
      }

      const total = problems.length;
      const msg = incorrectIndexes.length === 0
        ? `축하합니다! ${total}문제 모두 정답입니다!`
        : `총 ${total}문제 중 ${total - incorrectIndexes.length}문제 정답, ${incorrectIndexes.length}문제 오답`;
      document.getElementById("endMessage").innerText = msg;
    }

    function retryIncorrect() {
      if (incorrectIndexes.length === 0) {
        alert("오답이 없습니다. 먼저 채점을 해주세요.");
        return;
      }
      generateProblems(true);
    }

    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    // 초기화
    window.onload = () => {
      document.getElementById("problems").innerHTML = "<p>난이도를 선택한 후 문제를 시작하세요.</p>";
    };
  </script>
</body>
</html>
